<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="Bonsa">

<!-- 거래처 조회 -->
<select id="SearchAllDeptList"
resultType="com.green.mart.vo.DeptVo">
SELECT D.D_ID, D.D_NAME , D.D_DAM, D.D_PHONE 
FROM DEPT D 
WHERE D.D_NAME LIKE '%'||#{d_name}||'%'
ORDER BY D.D_NAME ASC
</select>
<select id="DeptView" 
resultType = "com.green.mart.vo.DeptVo">
SELECT d_id, d_name, d_dam, d_phone
FROM dept
WHERE d_id = #{d_id}
</select>
<insert id="DeptInset">
INSERT INTO dept
( d_id, d_name, d_dam,d_phone )
VALUES
( #{d_id}, #{d_name}, #{d_dam}, #{d_phone} )
</insert>
<delete id="DeptDel">
DELETE FROM dept
WHERE d_id = #{d_id}
</delete>

<!-- ================================================================= -->
<!-- 사용자관리 --> 
<select id="EmpList"
    resultType="com.green.mart.vo.EmployeeVo">
SELECT e_id, e_name, e_phone, e_intro, e_indate, j_name 
FROM employee e join jumpo j 
ON e.j_id = j.j_id 
ORDER BY e_id asc 
</select>

<select id="EmpView"
	resultType="com.green.mart.vo.EmployeeVo">
SELECT e_id, e_name, e_passwd, e_phone, e_intro, j_name, e_indate
FROM employee e join jumpo j 
on e.j_id = j.j_id
WHERE e_id = #{e_id}
</select>

<insert id="EmpInsert">
INSERT INTO employee
(e_id, e_name, e_passwd, e_intro,e_phone, j_id)
VALUES
(#{e_id},#{e_name},#{e_passwd},#{e_intro},#{e_phone},#{j_id})
</insert>  

<delete id="EmpDelete">
	DELETE FROM employee
	WHERE e_id = #{e_id}
</delete>   

<update id="EmpUpdate">
	UPDATE employee
	   SET e_name=#{e_name},
	       e_passwd= #{e_passwd},
	       e_intro = #{e_intro},
	       e_phone = #{e_phone},
	       j_id = #{j_id}
	 WHERE e_id = #{e_id} 

</update>
 <!-- ============================================ -->

 <select id="SearchSale"
resultType="com.green.mart.vo.JumpoVo">
SELECT J_NAME FROM JUMPO

</select>
<!-- 상품매출조회 -->
<select id="SearchSalesList"
resultType="com.green.mart.vo.work.SearchProductVo">
SELECT D.D_NAME, P.P_ID, P.P_NAME, P.P_IPRICE, P.P_SPRICE, D.D_ID, NVL(S.S_NUM,0) S_NUM,
NVL(T.ST_NUM, 0) ST_NUM, P.A_ID, S.S_DATE , (SELECT J_NAME FROM JUMPO WHERE J_ID = P.J_ID) J_NAME , (SELECT A_NAME FROM ASSORTMENT WHERE A_ID = P.A_ID) A_NAME
FROM PRODUCT P , STOCK T, DEPT D, SALE S
WHERE D.D_ID = T.D_ID
AND T.P_SEQ  = P.P_SEQ
AND P.P_SEQ  = S.P_SEQ
AND (SELECT J_NAME FROM JUMPO WHERE J_ID = P.J_ID) = #{j_name}
AND S_DATE BETWEEN  TO_DATE(#{startdate}) AND TO_DATE(#{enddate}) 
</select>
<select id="SearchSalesList1"
resultType="com.green.mart.vo.work.SearchProductVo">
SELECT D.D_NAME, P.P_ID, P.P_NAME, P.P_IPRICE, P.P_SPRICE, D.D_ID, NVL(S.S_NUM,0) S_NUM,
NVL(T.ST_NUM, 0) ST_NUM, P.A_ID, S.S_DATE , (SELECT J_NAME FROM JUMPO WHERE J_ID = P.J_ID) J_NAME , (SELECT A_NAME FROM ASSORTMENT WHERE A_ID = P.A_ID) A_NAME
FROM PRODUCT P , STOCK T, DEPT D, SALE S
WHERE D.D_ID = T.D_ID
AND T.P_SEQ  = P.P_SEQ
AND P.P_SEQ  = S.P_SEQ
AND ((#{j_name} = '' AND (SELECT J_NAME FROM JUMPO WHERE J_ID = P.J_ID) IN ('본사', '부전점')) OR (SELECT J_NAME FROM JUMPO WHERE J_ID = P.J_ID) = '본사' OR (SELECT J_NAME FROM JUMPO WHERE J_ID = P.J_ID) = '부전점')
AND S_DATE BETWEEN TO_DATE(#{startdate}) AND TO_DATE(#{enddate})
</select>
 
 
</mapper>